<script type="module">
  // Import Firebase modules
  import { initializeApp } from "firebase/app";
  import { getDatabase, ref, onValue } from "firebase/database";

  // Firebase config (your project)
  const firebaseConfig = {
    apiKey: "AIzaSyCPbOZwAZEMiC1LSDSgnSEPmSxQ7-pR2oQ",
    authDomain: "mirdhuna-25542.firebaseapp.com",
    databaseURL: "https://mirdhuna-25542-default-rtdb.firebaseio.com",
    projectId: "mirdhuna-25542",
    storageBucket: "mirdhuna-25542.firebasestorage.app",
    messagingSenderId: "575924409876",
    appId: "1:575924409876:web:6ba1ed88ce941d9c83b901",
    measurementId: "G-YB7LDKHBPV"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Reference to 'slider' node in Realtime DB
  const sliderRef = ref(db, 'slider');

  // DOM elements
  const sliderContainer = document.getElementById('slider');
  const nav = document.getElementById('sliderNav');

  // Listen for real-time updates
  onValue(sliderRef, (snapshot) => {
    const slidesData = snapshot.val();

    if (slidesData) {
      const slidesArray = Object.values(slidesData); // Convert object to array of slide objects
      renderSlides(slidesArray);
      initializeSlider();
    } else {
      sliderContainer.innerHTML = '<p class="text-white">No slides available.</p>';
    }

    // Remove loading spinner
    const loading = sliderContainer.querySelector('.loading');
    if (loading) loading.remove();
  }, (error) => {
    console.error("Error loading slides:", error);
    sliderContainer.innerHTML = '<p class="text-red-500">Failed to load slides.</p>';
    const loading = sliderContainer.querySelector('.loading');
    if (loading) loading.remove();
  });

  // Render each slide
  function renderSlides(slides) {
    sliderContainer.innerHTML = '';
    nav.innerHTML = '';

    slides.forEach((slide, index) => {
      const slideEl = document.createElement('div');
      slideEl.classList.add('slide');

      // Set background image
      if (slide.url) {
        slideEl.style.backgroundImage = `url(${slide.url})`;
      }

      // Add content
      const content = document.createElement('div');
      content.classList.add('slide-content');
      content.innerHTML = `
        <h2>${slide.text || 'No Title'}</h2>
        <p>${slide.description || ''}</p>
      `;
      slideEl.appendChild(content);
      sliderContainer.appendChild(slideEl);

      // Create dot navigation
      const dot = document.createElement('div');
      dot.classList.add('slider-dot');
      if (index === 0) dot.classList.add('active');
      dot.addEventListener('click', () => goToSlide(index));
      nav.appendChild(dot);
    });
  }

  // Slider control logic
  let currentSlide = 0;

  function initializeSlider() {
    const slides = document.querySelectorAll('.slide');
    const dots = document.querySelectorAll('.slider-dot');
    const totalSlides = slides.length;

    function updateSlider() {
      sliderContainer.style.transform = `translateX(-${currentSlide * 100}%)`;

      // Update active dot
      dots.forEach((dot, i) => {
        dot.classList.toggle('active', i === currentSlide);
      });
    }

    // Go to specific slide
    window.goToSlide = (index) => {
      if (index >= 0 && index < totalSlides) {
        currentSlide = index;
        updateSlider();
      }
    };

    // Previous button
    document.querySelector('.prev')?.addEventListener('click', () => {
      currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
      updateSlider();
    });

    // Next button
    document.querySelector('.next')?.addEventListener('click', () => {
      currentSlide = (currentSlide + 1) % totalSlides;
      updateSlider();
    });

    // Initial render
    updateSlider();
  }
</script>
