<script type="module">
  // Import Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCPbOZwAZEMiC1LSDSgnSEPmSxQ7-pR2oQ",
    authDomain: "mirdhuna-25542.firebaseapp.com",
    databaseURL: "https://mirdhuna-25542-default-rtdb.firebaseio.com",
    projectId: "mirdhuna-25542",
    storageBucket: "mirdhuna-25542.firebasestorage.app",
    messagingSenderId: "575924409876",
    appId: "1:575924409876:web:6ba1ed88ce941d9c83b901",
    measurementId: "G-YB7LDKHBPV"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Reference to the 'slider' node
  const sliderRef = ref(db, 'slider');

  // DOM Elements
  const sliderContainer = document.getElementById('slider');
  const nav = document.getElementById('sliderNav');

  // Listen for real-time updates
  onValue(sliderRef, (snapshot) => {
    const data = snapshot.val();

    if (data) {
      const slides = Object.values(data); // Convert to array
      renderSlides(slides);
      initializeSlider();
    } else {
      sliderContainer.innerHTML = '<p class="text-white">No slides found.</p>';
    }

    // Hide loading
    const loading = sliderContainer.querySelector('.loading');
    if (loading) loading.remove();
  }, (error) => {
    console.error("Error loading slides:", error);
    sliderContainer.innerHTML = '<p class="text-red-500">Failed to load slides.</p>';
    const loading = sliderContainer.querySelector('.loading');
    if (loading) loading.remove();
  });

  // Render slides
  function renderSlides(slides) {
    sliderContainer.innerHTML = '';
    nav.innerHTML = '';

    slides.forEach((slide, index) => {
      const slideEl = document.createElement('div');
      slideEl.classList.add('slide');
      slideEl.style.backgroundImage = `url(${slide.url})`;

      const content = document.createElement('div');
      content.classList.add('slide-content');
      content.innerHTML = `<h2>${slide.text || 'Slide'}</h2>`;
      slideEl.appendChild(content);
      sliderContainer.appendChild(slideEl);

      const dot = document.createElement('div');
      dot.classList.add('slider-dot');
      if (index === 0) dot.classList.add('active');
      dot.addEventListener('click', () => goToSlide(index));
      nav.appendChild(dot);
    });
  }

  // Slider logic
  let currentSlide = 0;
  function initializeSlider() {
    const slides = document.querySelectorAll('.slide');
    const dots = document.querySelectorAll('.slider-dot');
    const total = slides.length;

    const update = () => {
      sliderContainer.style.transform = `translateX(-${currentSlide * 100}%)`;
      dots.forEach((dot, i) => dot.classList.toggle('active', i === currentSlide));
    };

    window.goToSlide = (i) => { if (i >= 0 && i < total) currentSlide = i; update(); };

    document.querySelector('.prev')?.addEventListener('click', () =>
      currentSlide = (currentSlide - 1 + total) % total, update()
    );
    document.querySelector('.next')?.addEventListener('click', () =>
      currentSlide = (currentSlide + 1) % total, update()
    );

    update();
  }
</script>
