<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slider Management - Mirdhuna Admin</title>
    <!-- Include Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #34495e;
            --border: #bdc3c7;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; padding: 0;
            background-color: #f4f6f8; color: #333;
            line-height: 1.5;
        }
        #login-overlay {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000;
        }
        #login-form {
            background: white; padding: 25px;
            border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            text-align: center; width: 95%; max-width: 400px;
        }
        #login-form h2 { margin-top: 0; color: var(--primary); }
        #admin-password {
            width: 100%; padding: 12px; margin: 15px 0;
            border: 1px solid var(--border); border-radius: 4px;
        }
        #login-btn {
            background-color: var(--secondary); color: white;
            border: none; padding: 12px 20px; border-radius: 4px;
            cursor: pointer; width: 100%; font-weight: bold;
        }
        #login-btn:hover { background-color: #2980b9; }
        #login-message { color: var(--danger); margin-top: 10px; }

        #slider-content { display: none; padding: 15px; max-width: 100%; margin: 0 auto; }
        header {
            background-color: var(--primary); color: white;
            padding: 15px; text-align: center;
            margin-bottom: 20px; border-radius: 5px;
        }
        header h1 { margin: 0; font-size: 1.4rem; }

        .section {
            background: white; margin-bottom: 20px;
            border-radius: 5px; overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .section-header {
            background-color: var(--light);
            padding: 15px; border-bottom: 1px solid var(--border);
            font-weight: bold;
        }
        .section-content { padding: 15px; }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-control {
            width: 100%; padding: 10px;
            border: 1px solid var(--border); border-radius: 4px;
            box-sizing: border-box; font-size: 1rem;
        }
        /* Removed styling for file input type as it's not used */

        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
        th, td { border: 1px solid var(--border); padding: 10px 8px; text-align: left; word-wrap: break-word; }
        th { background-color: #f8f9fa; }

        .btn {
            padding: 6px 10px; margin: 2px;
            border: none; border-radius: 4px; cursor: pointer;
            font-size: 0.85rem;
        }
        .btn-primary { background-color: var(--secondary); color: white; }
        .btn-success { background-color: var(--success); color: white; }
        .btn-danger { background-color: var(--danger); color: white; }

        /* Progress bar styles removed as upload is no longer used */
        /*
        .upload-progress {
            width: 100%; height: 15px;
            background-color: #f0f0f0; border-radius: 10px;
            overflow: hidden; margin-top: 10px; display: none;
        }
        .upload-progress-bar {
            height: 100%; background-color: var(--success);
            width: 0%; transition: width 0.3s ease;
        }
        */

        .table-container { overflow-x: auto; margin: 10px 0; }
        table { min-width: 600px; }

        /* --- Image Display Fixes --- */
        .slider-image {
            width: 100px; /* Set a fixed width */
            height: 75px; /* Set a fixed height */
            object-fit: cover; /* Ensures image covers the area without distortion */
            border-radius: 4px;
            display: block; /* Ensures proper layout */
            margin: 0 auto; /* Centers the image if needed */
        }

        @media (min-width: 768px) {
            #login-form { padding: 30px; }
            #login-form h2 { font-size: 1.8rem; }
            #slider-content { padding: 20px; }
            header h1 { font-size: 1.8rem; }
            .section-header { font-size: 1.3rem; }
            table { font-size: 1rem; }
            th, td { padding: 12px 15px; }
            .btn { padding: 6px 12px; font-size: 0.9rem; }
            .form-control { font-size: 1rem; }
            .slider-image {
                 width: 150px;
                 height: 100px;
            }
        }
        @media (min-width: 1024px) {
            #slider-content { max-width: 1200px; padding: 20px; }
        }
    </style>
</head>
<body>

    <!-- Login Overlay -->
    <div id="login-overlay">
        <div id="login-form">
            <h2>Slider Management Login</h2>
            <input type="password" id="admin-password" placeholder="Enter password (Sanu.0000)" />
            <button id="login-btn">Login</button>
            <p id="login-message"></p>
        </div>
    </div>

    <!-- Main Slide Management Content -->
    <div id="slider-content">
        <header><h1>Mirdhuna Slide Management</h1></header>

        <!-- Add New Slide Section (Modified for URL Input) -->
        <div class="section">
            <div class="section-header">Add New Slide</div>
            <div class="section-content">
                <!-- Replaced file upload with URL input -->
                <div class="form-group">
                    <label for="new-slider-image-url">Image URL:</label>
                    <input type="url" id="new-slider-image-url" class="form-control" placeholder="Enter the full image URL (e.g., https://example.com/image.jpg)" required>
                    <small>Provide a direct link to the image you want to use.</small>
                </div>
                <div class="form-group">
                    <label for="new-slider-text">Text Description:</label>
                    <textarea id="new-slider-text" class="form-control" placeholder="Enter slide text..." rows="3" required></textarea>
                </div>
                <button class="btn btn-success" id="add-slider-btn">Add Slide</button>
                <!-- Removed upload progress bar as it's not needed -->
                <!--
                <div class="upload-progress" id="slider-upload-progress">
                    <div class="upload-progress-bar" id="slider-progress-bar"></div>
                </div>
                -->
            </div>
        </div>

        <!-- Existing Slides Section -->
        <div class="section">
            <div class="section-header">Existing Slides</div>
            <div class="section-content">
                <div class="table-container">
                <table id="slides-table">
                    <thead><tr>
                        <th>Image</th><th>Description</th><th>Actions</th>
                    </tr></thead>
                    <tbody><!-- Slides populated by JS --></tbody>
                </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Firebase Configuration ---
        // IMPORTANT: Ensure databaseURL does NOT have trailing spaces!
        const firebaseConfig = {
            apiKey: "AIzaSyB0sVoG5VdOxmk4ZM5m837pN2uQ3XfRwZw",
            authDomain: "mirdhuna-25542.firebaseapp.com",
            databaseURL: "https://mirdhuna-25542-default-rtdb.firebaseio.com", // Removed trailing space
            projectId: "mirdhuna-25542",
            storageBucket: "mirdhuna-25542.appspot.com",
            messagingSenderId: "1078913123456",
            appId: "1:1078913123456:web:placeholder",
            measurementId: "G-XXXXXXXXXX"
        };

        // --- Initialize Firebase ---
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();
        // const storage = firebase.storage(); // No longer needed for URL input

        // --- Login Logic ---
        document.getElementById('login-btn').addEventListener('click', checkPassword);
        document.getElementById('admin-password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') checkPassword();
        });

        function checkPassword() {
            const password = document.getElementById('admin-password').value;
            const messageElement = document.getElementById('login-message');
            if (password === 'Sanu.0000') {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('slider-content').style.display = 'block';
                fetchSlides(); // Start fetching data after login
            } else {
                messageElement.textContent = 'Incorrect password.';
            }
        }

        // --- Fetch and Display Slides ---
        function fetchSlides() {
            const slidesRef = database.ref('slider');
            slidesRef.on('value', (snapshot) => {
                const slides = snapshot.val();
                const tableBody = document.querySelector('#slides-table tbody');
                tableBody.innerHTML = '';

                if (!slides) {
                    tableBody.innerHTML = '<tr><td colspan="3">No slides found.</td></tr>';
                    return;
                }

                for (const slideId in slides) {
                    if (slides.hasOwnProperty(slideId)) {
                        const slide = slides[slideId];
                        const row = document.createElement('tr');

                        // Use the new CSS class 'slider-image' for consistent sizing
                        row.innerHTML = `
                            <td><img src="${slide.url || ''}" alt="Slide Image" class="slider-image" onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9Ijc1IiB2aWV3Qm94PSIwIDAgMTAwIDc1IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9Ijc1IiBmaWxsPSIjRUJFQkVCIi8+CjxwYXRoIGQ9Ik01MCAyNUM1NS41MjI4IDI1IDYwIDI5LjQ3NzIgNjAgMzVDMTUgNDUgODQgNDUgNTAgNTVDMzQuNDc3MiA0NSAzMCA0MC41MjI4IDMwIDM1QzMwIDI5LjQ3NzIgMzQuNDc3MiAyNSA0MCAyNVoiIHN0cm9rZT0iIzk5OSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPgo=';"></td>
                            <td>${slide.text || ''}</td>
                            <td>
                                <button class="btn btn-danger delete-slider-btn" data-slide-id="${slideId}">Delete</button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    }
                }

                // Add event listeners to the newly created delete buttons
                document.querySelectorAll('.delete-slider-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const slideId = this.getAttribute('data-slide-id');
                        deleteSlide(slideId);
                    });
                });

            }, (error) => {
                 console.error("Error fetching slides:", error);
                 document.querySelector('#slides-table tbody').innerHTML = `<tr><td colspan="3">Error loading slides: ${error.message || 'Permission denied or network issue.'}</td></tr>`;
            });
        }

        // --- Add New Slide (Modified for URL Input) ---
        document.getElementById('add-slider-btn').addEventListener('click', addSlide);

        function addSlide() {
            // Get the URL input value
            const urlInput = document.getElementById('new-slider-image-url');
            const imageUrl = urlInput.value.trim(); // Get the URL string

            // Get the text input value
            const textInput = document.getElementById('new-slider-text');
            const text = textInput.value.trim();

            // Validation
            if (!imageUrl) {
                alert("Please enter an Image URL.");
                urlInput.focus();
                return;
            }
            // Basic URL validation (HTML5 'type="url"' helps, but extra check is good)
            try {
                new URL(imageUrl); // This will throw an error if the URL is invalid
            } catch (e) {
                 alert("Please enter a valid Image URL.");
                 urlInput.focus();
                 return;
            }

            if (!text) {
                alert("Please enter a Text Description.");
                textInput.focus();
                return;
            }


            // Save data directly to the database using the provided URL
            const newSlideRef = database.ref('slider').push();
            newSlideRef.set({
                url: imageUrl, // Use the provided URL
                text: text
            })
            .then(() => {
                console.log("Slide data (URL) saved to database.");
                // Clear form fields on success
                urlInput.value = '';
                textInput.value = '';
                alert("Slide added successfully using the provided URL!");
            })
            .catch((error) => {
                console.error("Error saving slide with URL:", error);
                alert("Failed to add slide: " + (error.message || error.code));
                // Optionally, clear fields on error too
                // urlInput.value = '';
                // textInput.value = '';
            });
        }


        // --- Delete Slide (Unchanged) ---
        function deleteSlide(slideId) {
             if (!confirm(`Are you sure you want to permanently delete this slide?`)) {
                return; // If user clicks 'Cancel', do nothing
            }

            // Reference the specific slide in the database
            const slideRef = database.ref(`slider/${slideId}`);

            // Remove the slide data from the database
            slideRef.remove()
                .then(() => {
                    console.log(`Slide ${slideId} deleted successfully.`);
                    alert(`Slide has been deleted.`);
                    // Note: The UI will automatically update due to the .on('value') listener in fetchSlides
                })
                .catch((error) => {
                    console.error("Error deleting slide:", error);
                    alert("Failed to delete slide. Please try again.");
                });
        }
    </script>
</body>
    </html>
